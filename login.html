<html>

    <head>
        <title>Index</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.18/vue.min.js"></script>
        <script src="includes/js/md5.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    </head>
    <script>
        // check if logged in..
        var logged = document.cookie;
        if(logged != "") {
            var parts = (logged.split("user="))[1];
            var values = JSON.parse(parts);
        }
    </script>
    <body>
        <div id="demo">
            <input type="text" id="username" placeholder="username" />
            <input type="password" id="password" placeholder="password" />
            <button v-on:click="login" name="login">Login</button>
            <br/><br/>
            <button v-on:click="logout" name="logout">Logout</button>
        </div>
    </body>
</html>

<script>

var demo = new Vue({
  el: '#demo',
  data : {
    values : null
  },
  methods: {
    logout: function() {
        document.cookie = "user=; Max-Age=0";
    },
    login: function () {
        // Place them in variables for the form checks
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;

        if(username == "" || password == ""){
            console.log("Een veld is leeg.");
        }
        else {
            var xhrExist = new XMLHttpRequest();
            password = md5(password);
            xhrExist.open('GET', 'http://localhost:8080/users/'+username+'/'+password);
            xhrExist.onload = function () {
                // Response text is empty or an object..
                var exists = JSON.parse(xhrExist.responseText);

                if(exists[0]){
                    // jsonstring for the data in the cookie
                    var d = exists[0];
                    var user_data = JSON.stringify({ user_id: d.user_id, username : d.username, email : d.email, date : d.date_of_birth });
                    // set expire date (1 day)
                    var d = new Date();
                    d.setTime(d.getTime() + (1*24*60*60*1000));
                    var expires = ";expires="+ d.toUTCString();
                    // set cookie
                    document.cookie = "user="+user_data+expires+";";
                }
                else {
                    console.log("Bestaat niet.");
                }
            }
            xhrExist.send();
        }
    }
  }
})
</script>
