<html>

    <head>
    </head>

    <body>
      <div id="content">
        <div id="demo">
            <input type="text" id="username" placeholder="username" />
            <input type="password" id="password" placeholder="password" />
            <input type="email" id="email" placeholder="email"/>
            <input type="text" id="date" placeholder="date"/>
            <button v-on:click="saveData" name="save">Registreren</button>
        </div>
      </div>
    </body>
</html>

<script src="../includes/master/master.js"></script>
<script src="../includes/js/md5.js"></script>
<script>

function isValidDate(dateString) {
  var regEx = /^\d{4}-\d{2}-\d{2}$/;
  return dateString.match(regEx) != null;
}

$(document).ready(function() {
      document.title += 'register';
});

var demo = new Vue({
  el: '#demo',
  data : {
    values : null
  },
  methods: {
    saveData: function () {
        // Place them in variables for the form checks
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;
        var email    = document.getElementById('email').value;
        var date     = document.getElementById('date').value;

        if(username == "" || password == "" || email == "" || date == ""){
            alert("Je hebt een veld leeggelaten.");
        }
        else if(password.length < 5) {
            alert("Password has to be at least 5 characters")
        }
        else if(!isValidDate(date)) {
            alert("Please enter a valid date (yyyy-mm-dd)");
        }
        else {
            var xhrExist = new XMLHttpRequest();
            xhrExist.open('GET', local+'users/'+username+'/find');
            xhrExist.onload = function () {
                // Response text is empty or an object..
                var exists = JSON.parse(xhrExist.responseText);

                if(exists[0]){
                    alert("Username in gebruik.")
                }
                else {
                    // MD5 the password
                    password = md5(password);
                    // Place the data in an object to convert to a json string
                    var values = {
                        username : username,
                        password : password,
                        email : email,
                        date_of_birth : date
                    };
                    
                    // Convert object to jsonstring
                    values = JSON.stringify(values);
                    // HTTP post request
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', local+'/users/create');
                    // Send our values
                    xhr.send(values);

                    window.location = '/user/login.html';
                }
            }
            xhrExist.send();
        }
    }
  }
})
</script>
