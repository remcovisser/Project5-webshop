<html>

    <head>
    </head>

    <body>
      <div id="content">
        <div id="demo">
            <input type="text" id="username" placeholder="username" />
            <input type="password" id="password" placeholder="password" />
            <input type="email" id="email" placeholder="email"/>
            <input type="text" id="date" placeholder="date"/>
            <button v-on:click="saveData" name="save">Registreren</button>
        </div>
      </div>
    </body>
</html>

<script src="../includes/master/master.js"></script>
<script src="../includes/js/md5.js"></script>
<script>
$(document).ready(function() {
      document.title += 'register';
});
var local = 'http://localhost:8080/users/create';
var live  = 'http://95.85.32.165:8080/users';

var demo = new Vue({
  el: '#demo',
  data : {
    values : null
  },
  methods: {
    saveData: function () {
        // Place them in variables for the form checks
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;
        var email    = document.getElementById('email').value;
        var date     = document.getElementById('date').value;

        if(username == "" || password == "" || email == "" || date == ""){
            console.log("Een veld is leeg.");
        }
        else {
            var xhrExist = new XMLHttpRequest();
            xhrExist.open('GET', 'http://localhost:8080/users/'+username+'/find');
            xhrExist.onload = function () {
                // Response text is empty or an object..
                var exists = JSON.parse(xhrExist.responseText);

                if(exists[0]){
                    console.log("Bestaat al.");
                }
                else {
                    // MD5 the password
                    password = md5(password);
                    // Place the data in an object to convert to a json string
                    var values = {
                        username : username,
                        password : password,
                        email : email,
                        date : date
                    };

                    // Convert object to jsonstring
                    values = JSON.stringify(values);
                    // HTTP post request
                    var xhr = new XMLHttpRequest();
                    xhr.open('POST', local);
                    // Send our values
                    xhr.send(values);
                }
            }
            xhrExist.send();
        }
    }
  }
})
</script>
